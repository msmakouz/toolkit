!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("@spiral-toolkit/core")):"function"==typeof define&&define.amd?define("@spiral-toolkit/datagrid",["@spiral-toolkit/core"],e):"object"==typeof exports?exports["@spiral-toolkit/datagrid"]=e(require("@spiral-toolkit/core")):t.SFDataGrid=e(t["@spiral-toolkit/core"])}(window,(function(t){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/",r(r.s=2)}([function(e,r){e.exports=t},function(t,e,r){"use strict";(function(e){var n=r(4);
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */function i(t,e){if(t===e)return 0;for(var r=t.length,n=e.length,i=0,s=Math.min(r,n);i<s;++i)if(t[i]!==e[i]){r=t[i],n=e[i];break}return r<n?-1:n<r?1:0}function s(t){return e.Buffer&&"function"==typeof e.Buffer.isBuffer?e.Buffer.isBuffer(t):!(null==t||!t._isBuffer)}var o=r(5),a=Object.prototype.hasOwnProperty,c=Array.prototype.slice,l="foo"===function(){}.name;function u(t){return Object.prototype.toString.call(t)}function p(t){return!s(t)&&("function"==typeof e.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):!!t&&(t instanceof DataView||!!(t.buffer&&t.buffer instanceof ArrayBuffer))))}var f=t.exports=b,h=/\s*function\s+([^\(\s]*)\s*/;function d(t){if(o.isFunction(t)){if(l)return t.name;var e=t.toString().match(h);return e&&e[1]}}function g(t,e){return"string"==typeof t?t.length<e?t:t.slice(0,e):t}function m(t){if(l||!o.isFunction(t))return o.inspect(t);var e=d(t);return"[Function"+(e?": "+e:"")+"]"}function y(t,e,r,n,i){throw new f.AssertionError({message:r,actual:t,expected:e,operator:n,stackStartFunction:i})}function b(t,e){t||y(t,!0,e,"==",f.ok)}function v(t,e,r,n){if(t===e)return!0;if(s(t)&&s(e))return 0===i(t,e);if(o.isDate(t)&&o.isDate(e))return t.getTime()===e.getTime();if(o.isRegExp(t)&&o.isRegExp(e))return t.source===e.source&&t.global===e.global&&t.multiline===e.multiline&&t.lastIndex===e.lastIndex&&t.ignoreCase===e.ignoreCase;if(null!==t&&"object"==typeof t||null!==e&&"object"==typeof e){if(p(t)&&p(e)&&u(t)===u(e)&&!(t instanceof Float32Array||t instanceof Float64Array))return 0===i(new Uint8Array(t.buffer),new Uint8Array(e.buffer));if(s(t)!==s(e))return!1;var a=(n=n||{actual:[],expected:[]}).actual.indexOf(t);return-1!==a&&a===n.expected.indexOf(e)||(n.actual.push(t),n.expected.push(e),function(t,e,r,n){if(null==t||null==e)return!1;if(o.isPrimitive(t)||o.isPrimitive(e))return t===e;if(r&&Object.getPrototypeOf(t)!==Object.getPrototypeOf(e))return!1;var i=E(t),s=E(e);if(i&&!s||!i&&s)return!1;if(i)return t=c.call(t),e=c.call(e),v(t,e,r);var a,l,u=j(t),p=j(e);if(u.length!==p.length)return!1;for(u.sort(),p.sort(),l=u.length-1;l>=0;l--)if(u[l]!==p[l])return!1;for(l=u.length-1;l>=0;l--)if(a=u[l],!v(t[a],e[a],r,n))return!1;return!0}(t,e,r,n))}return r?t===e:t==e}function E(t){return"[object Arguments]"==Object.prototype.toString.call(t)}function O(t,e){if(!t||!e)return!1;if("[object RegExp]"==Object.prototype.toString.call(e))return e.test(t);try{if(t instanceof e)return!0}catch(t){}return!Error.isPrototypeOf(e)&&!0===e.call({},t)}function w(t,e,r,n){var i;if("function"!=typeof e)throw new TypeError('"block" argument must be a function');"string"==typeof r&&(n=r,r=null),i=function(t){var e;try{t()}catch(t){e=t}return e}(e),n=(r&&r.name?" ("+r.name+").":".")+(n?" "+n:"."),t&&!i&&y(i,r,"Missing expected exception"+n);var s="string"==typeof n,a=!t&&i&&!r;if((!t&&o.isError(i)&&s&&O(i,r)||a)&&y(i,r,"Got unwanted exception"+n),t&&i&&r&&!O(i,r)||!t&&i)throw i}f.AssertionError=function(t){var e;this.name="AssertionError",this.actual=t.actual,this.expected=t.expected,this.operator=t.operator,t.message?(this.message=t.message,this.generatedMessage=!1):(this.message=g(m((e=this).actual),128)+" "+e.operator+" "+g(m(e.expected),128),this.generatedMessage=!0);var r=t.stackStartFunction||y;if(Error.captureStackTrace)Error.captureStackTrace(this,r);else{var n=new Error;if(n.stack){var i=n.stack,s=d(r),o=i.indexOf("\n"+s);if(o>=0){var a=i.indexOf("\n",o+1);i=i.substring(a+1)}this.stack=i}}},o.inherits(f.AssertionError,Error),f.fail=y,f.ok=b,f.equal=function(t,e,r){t!=e&&y(t,e,r,"==",f.equal)},f.notEqual=function(t,e,r){t==e&&y(t,e,r,"!=",f.notEqual)},f.deepEqual=function(t,e,r){v(t,e,!1)||y(t,e,r,"deepEqual",f.deepEqual)},f.deepStrictEqual=function(t,e,r){v(t,e,!0)||y(t,e,r,"deepStrictEqual",f.deepStrictEqual)},f.notDeepEqual=function(t,e,r){v(t,e,!1)&&y(t,e,r,"notDeepEqual",f.notDeepEqual)},f.notDeepStrictEqual=function t(e,r,n){v(e,r,!0)&&y(e,r,n,"notDeepStrictEqual",t)},f.strictEqual=function(t,e,r){t!==e&&y(t,e,r,"===",f.strictEqual)},f.notStrictEqual=function(t,e,r){t===e&&y(t,e,r,"!==",f.notStrictEqual)},f.throws=function(t,e,r){w(!0,t,e,r)},f.doesNotThrow=function(t,e,r){w(!1,t,e,r)},f.ifError=function(t){if(t)throw t},f.strict=n((function t(e,r){e||y(e,!0,r,"==",t)}),f,{equal:f.strictEqual,deepEqual:f.deepStrictEqual,notEqual:f.notStrictEqual,notDeepEqual:f.notDeepStrictEqual}),f.strict.strict=f.strict;var j=Object.keys||function(t){var e=[];for(var r in t)a.call(t,r)&&e.push(r);return e}}).call(this,r(3))},function(t,e,r){t.exports=r(9)},function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e,r){"use strict";
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var n=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable;function o(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}t.exports=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},r=0;r<10;r++)e["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(e).map((function(t){return e[t]})).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach((function(t){n[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var r,a,c=o(t),l=1;l<arguments.length;l++){for(var u in r=Object(arguments[l]))i.call(r,u)&&(c[u]=r[u]);if(n){a=n(r);for(var p=0;p<a.length;p++)s.call(r,a[p])&&(c[a[p]]=r[a[p]])}}return c}},function(t,e,r){(function(t){var n=Object.getOwnPropertyDescriptors||function(t){for(var e=Object.keys(t),r={},n=0;n<e.length;n++)r[e[n]]=Object.getOwnPropertyDescriptor(t,e[n]);return r},i=/%[sdj%]/g;e.format=function(t){if(!y(t)){for(var e=[],r=0;r<arguments.length;r++)e.push(a(arguments[r]));return e.join(" ")}r=1;for(var n=arguments,s=n.length,o=String(t).replace(i,(function(t){if("%%"===t)return"%";if(r>=s)return t;switch(t){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(t){return"[Circular]"}default:return t}})),c=n[r];r<s;c=n[++r])g(c)||!E(c)?o+=" "+c:o+=" "+a(c);return o},e.deprecate=function(r,n){if(void 0!==t&&!0===t.noDeprecation)return r;if(void 0===t)return function(){return e.deprecate(r,n).apply(this,arguments)};var i=!1;return function(){if(!i){if(t.throwDeprecation)throw new Error(n);t.traceDeprecation?console.trace(n):console.error(n),i=!0}return r.apply(this,arguments)}};var s,o={};function a(t,r){var n={seen:[],stylize:l};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),d(r)?n.showHidden=r:r&&e._extend(n,r),b(n.showHidden)&&(n.showHidden=!1),b(n.depth)&&(n.depth=2),b(n.colors)&&(n.colors=!1),b(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=c),u(n,t,n.depth)}function c(t,e){var r=a.styles[e];return r?"["+a.colors[r][0]+"m"+t+"["+a.colors[r][1]+"m":t}function l(t,e){return t}function u(t,r,n){if(t.customInspect&&r&&j(r.inspect)&&r.inspect!==e.inspect&&(!r.constructor||r.constructor.prototype!==r)){var i=r.inspect(n,t);return y(i)||(i=u(t,i,n)),i}var s=function(t,e){if(b(e))return t.stylize("undefined","undefined");if(y(e)){var r="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(r,"string")}if(m(e))return t.stylize(""+e,"number");if(d(e))return t.stylize(""+e,"boolean");if(g(e))return t.stylize("null","null")}(t,r);if(s)return s;var o=Object.keys(r),a=function(t){var e={};return t.forEach((function(t,r){e[t]=!0})),e}(o);if(t.showHidden&&(o=Object.getOwnPropertyNames(r)),w(r)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return p(r);if(0===o.length){if(j(r)){var c=r.name?": "+r.name:"";return t.stylize("[Function"+c+"]","special")}if(v(r))return t.stylize(RegExp.prototype.toString.call(r),"regexp");if(O(r))return t.stylize(Date.prototype.toString.call(r),"date");if(w(r))return p(r)}var l,E="",C=!1,S=["{","}"];(h(r)&&(C=!0,S=["[","]"]),j(r))&&(E=" [Function"+(r.name?": "+r.name:"")+"]");return v(r)&&(E=" "+RegExp.prototype.toString.call(r)),O(r)&&(E=" "+Date.prototype.toUTCString.call(r)),w(r)&&(E=" "+p(r)),0!==o.length||C&&0!=r.length?n<0?v(r)?t.stylize(RegExp.prototype.toString.call(r),"regexp"):t.stylize("[Object]","special"):(t.seen.push(r),l=C?function(t,e,r,n,i){for(var s=[],o=0,a=e.length;o<a;++o)k(e,String(o))?s.push(f(t,e,r,n,String(o),!0)):s.push("");return i.forEach((function(i){i.match(/^\d+$/)||s.push(f(t,e,r,n,i,!0))})),s}(t,r,n,a,o):o.map((function(e){return f(t,r,n,a,e,C)})),t.seen.pop(),function(t,e,r){if(t.reduce((function(t,e){return e.indexOf("\n")>=0&&0,t+e.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60)return r[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+r[1];return r[0]+e+" "+t.join(", ")+" "+r[1]}(l,E,S)):S[0]+E+S[1]}function p(t){return"["+Error.prototype.toString.call(t)+"]"}function f(t,e,r,n,i,s){var o,a,c;if((c=Object.getOwnPropertyDescriptor(e,i)||{value:e[i]}).get?a=c.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):c.set&&(a=t.stylize("[Setter]","special")),k(n,i)||(o="["+i+"]"),a||(t.seen.indexOf(c.value)<0?(a=g(r)?u(t,c.value,null):u(t,c.value,r-1)).indexOf("\n")>-1&&(a=s?a.split("\n").map((function(t){return"  "+t})).join("\n").substr(2):"\n"+a.split("\n").map((function(t){return"   "+t})).join("\n")):a=t.stylize("[Circular]","special")),b(o)){if(s&&i.match(/^\d+$/))return a;(o=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=t.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=t.stylize(o,"string"))}return o+": "+a}function h(t){return Array.isArray(t)}function d(t){return"boolean"==typeof t}function g(t){return null===t}function m(t){return"number"==typeof t}function y(t){return"string"==typeof t}function b(t){return void 0===t}function v(t){return E(t)&&"[object RegExp]"===C(t)}function E(t){return"object"==typeof t&&null!==t}function O(t){return E(t)&&"[object Date]"===C(t)}function w(t){return E(t)&&("[object Error]"===C(t)||t instanceof Error)}function j(t){return"function"==typeof t}function C(t){return Object.prototype.toString.call(t)}function S(t){return t<10?"0"+t.toString(10):t.toString(10)}e.debuglog=function(r){if(b(s)&&(s=t.env.NODE_DEBUG||""),r=r.toUpperCase(),!o[r])if(new RegExp("\\b"+r+"\\b","i").test(s)){var n=t.pid;o[r]=function(){var t=e.format.apply(e,arguments);console.error("%s %d: %s",r,n,t)}}else o[r]=function(){};return o[r]},e.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=h,e.isBoolean=d,e.isNull=g,e.isNullOrUndefined=function(t){return null==t},e.isNumber=m,e.isString=y,e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=b,e.isRegExp=v,e.isObject=E,e.isDate=O,e.isError=w,e.isFunction=j,e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=r(7);var T=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function x(){var t=new Date,e=[S(t.getHours()),S(t.getMinutes()),S(t.getSeconds())].join(":");return[t.getDate(),T[t.getMonth()],e].join(" ")}function k(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.log=function(){console.log("%s - %s",x(),e.format.apply(e,arguments))},e.inherits=r(8),e._extend=function(t,e){if(!e||!E(e))return t;for(var r=Object.keys(e),n=r.length;n--;)t[r[n]]=e[r[n]];return t};var P="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function A(t,e){if(!t){var r=new Error("Promise was rejected with a falsy value");r.reason=t,t=r}return e(t)}e.promisify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');if(P&&t[P]){var e;if("function"!=typeof(e=t[P]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(e,P,{value:e,enumerable:!1,writable:!1,configurable:!0}),e}function e(){for(var e,r,n=new Promise((function(t,n){e=t,r=n})),i=[],s=0;s<arguments.length;s++)i.push(arguments[s]);i.push((function(t,n){t?r(t):e(n)}));try{t.apply(this,i)}catch(t){r(t)}return n}return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),P&&Object.defineProperty(e,P,{value:e,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(e,n(t))},e.promisify.custom=P,e.callbackify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');function r(){for(var r=[],n=0;n<arguments.length;n++)r.push(arguments[n]);var i=r.pop();if("function"!=typeof i)throw new TypeError("The last argument must be of type Function");var s=this,o=function(){return i.apply(s,arguments)};e.apply(this,r).then((function(e){t.nextTick(o,null,e)}),(function(e){t.nextTick(A,e,o)}))}return Object.setPrototypeOf(r,Object.getPrototypeOf(e)),Object.defineProperties(r,n(e)),r}}).call(this,r(6))},function(t,e){var r,n,i=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(t){if(r===setTimeout)return setTimeout(t,0);if((r===s||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:s}catch(t){r=s}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(t){n=o}}();var c,l=[],u=!1,p=-1;function f(){u&&c&&(u=!1,c.length?l=c.concat(l):p=-1,l.length&&h())}function h(){if(!u){var t=a(f);u=!0;for(var e=l.length;e;){for(c=l,l=[];++p<e;)c&&c[p].run();p=-1,e=l.length}c=null,u=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function d(t,e){this.fun=t,this.array=e}function g(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];l.push(new d(t,e)),1!==l.length||u||a(h)},d.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(t,e){t.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},function(t,e){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var r=function(){};r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t}},function(t,e,r){"use strict";r.r(e),r.d(e,"renders",(function(){return S}));var n,i,s=r(0),o=r.n(s),a=r(1);!function(t){t.ASC="asc",t.DESC="desc"}(n||(n={})),function(t){t.GET="GET",t.POST="POST",t.DELETE="DELETE",t.PUT="PUT",t.PATCH="PATCH"}(i||(i={}));class c{constructor(t){this.parent=t,this.state={loading:!1,paginator:{page:1,limit:25},sortDir:n.ASC,data:[],formData:{}}}get isLoading(){return this.state.loading}startLoading(){this.state.loading=!0}stopLoading(){this.state.loading=!1}get data(){return this.state.data}get paginate(){return this.state.paginator}updatePaginator(t){this.state.paginator=Object.assign(Object.assign({},this.state.paginator),t)}set data(t){this.state.data=t}get hasError(){return!!this.state.error}get errorMessage(){return this.state.error}get sortBy(){return this.state.sortBy}get sortDir(){return this.state.sortDir}setSuccess(t,e){this.data=t,this.state.error=void 0,this.state.errors=void 0,this.updatePaginator(e)}setError(t,e={},r=!1){r&&(this.data=[]),this.state.error=t,this.state.errors=e}setSort(t,e){this.state.sortBy=t,this.state.sortDir=e}setFormData(t,e){this.state.formData[t]=e}getFilter(){return Object.keys(this.state.formData).reduce((t,e)=>Object.assign(Object.assign({},t),this.state.formData[e]),{})}}var l;!function(t){t.pages="pages",t.infinite="infinite"}(l||(l={}));class u extends o.a.core.BaseDOMConstructor{constructor(t,e,r){super(),this.optionsToGrab={id:{value:u.defaultOptions.id,domAttr:"id"},type:{value:u.defaultOptions.type,domAttr:"data-type"},fetchCount:{value:u.defaultOptions.fetchCount,domAttr:"data-fetch-count"},fetchCountOnce:{value:u.defaultOptions.fetchCountOnce,domAttr:"data-fetch-count-once"}},this.options=Object.assign({},u.defaultOptions),this.state={fetching:!1,limit:25},this.init(t,e,r),this.options=Object.assign(Object.assign({},u.defaultOptions),this.options),this.render()}unlock(){this.options.lockType&&"none"!==this.options.lockType&&(this.sf.removeInstance("lock",this.node)||console.warn("You try to remove 'lock' instance, but it is not available or not started"))}lock(){if(!this.options.lockType||"none"===this.options.lockType)return;this.sf.addInstance("lock",this.node,{type:this.options.lockType})||console.warn("You try to add 'lock' instance, but it is not available or already started")}setParams(t){this.state=Object.assign(Object.assign({},this.state),t),this.render()}hasPages(){return void 0!==this.state.page&&void 0!==this.state.limit}hasTotal(){return void 0!==this.state.count}hasLimitOptions(){return void 0!==this.options.limitOptions}generatePageList(){const t=this.state.page,e=this.hasTotal()?Math.ceil(this.state.count/this.state.limit):t,r=!this.hasTotal()||t<e,n=t>1,i=[Math.max(t-1,1),Math.min(t+1,e)],s=[1,Math.min(2,e)],o=[Math.max(e-1,1),e],a=[];let c=1;do{a.push({page:c,text:`${c}`,active:t===c}),c>=s[1]&&c+1<i[0]?(a.push({page:void 0,text:"...",active:!1}),c=i[0]):c>=i[1]&&c+1<o[0]?(a.push({page:void 0,text:"...",active:!1}),c=o[0]):c+=1}while(c<=e);return{pages:a,hasNext:r,hasPrevious:n}}setLimit(t){this.state.limit=t,!this.options.onPageChange||this.options.onPageChange(this.state),this.render()}setPage(t){this.state.page=t,!this.options.onPageChange||this.options.onPageChange(this.state),this.render()}render(){const t=document.createElement("div");t.className="col-12 col-lg-4",this.hasPages()&&(this.hasTotal()?t.innerHTML=`Showing ${(this.state.page-1)*this.state.limit+1} to ${this.state.page*this.state.limit} of ${this.state.count} entries`:t.innerHTML=`Showing ${(this.state.page-1)*this.state.limit+1} to ${this.state.page*this.state.limit} entries`);const e=document.createElement("div");if(e.className="col-4 col-md-2 col-lg-2",this.hasLimitOptions()){e.innerHTML='<div class="form-group row mb-0">\n                    <label class="col-form-label-sm col-auto">Show</label>\n                    <select name="limit" class="custom-select custom-select-sm col-6">\n                    </select>\n                  </div>';const t=e.querySelector("select");this.options.limitOptions.forEach(e=>{const r=document.createElement("option");r.value=`${e}`,r.innerHTML=`${e}`,e===this.state.limit&&r.setAttribute("checked","checked"),t.appendChild(r)}),t.value=`${this.state.limit}`,t.addEventListener("change",e=>{this.setLimit(+t.value)})}const r=document.createElement("div");if(r.className="col-8 col-md-10 col-lg-6",this.hasPages()){r.innerHTML='<ul class="pagination pagination-sm justify-content-end mb-0">';const t=r.querySelector("ul"),e=this.generatePageList();{const r=document.createElement("li");r.className=e.hasPrevious?"page-item previous":"page-item previous disabled",e.hasPrevious&&r.addEventListener("click",()=>this.setPage(this.state.page-1)),r.innerHTML='<a href="#" tabindex="0" class="page-link">«</a>',t.appendChild(r)}e.pages.forEach(e=>{const r=document.createElement("li");r.className=e.active?"page-item active":"page-item",e.page?(r.addEventListener("click",()=>this.setPage(e.page)),r.innerHTML=`<a href="#" tabindex="0" class="page-link">${e.text}</a>`):r.innerHTML=`<a tabindex="0" class="page-link">${e.text}</a>`,t.appendChild(r)});{const r=document.createElement("li");r.className=e.hasNext?"page-item next":"page-item next disabled",e.hasNext&&r.addEventListener("click",()=>this.setPage(this.state.page+1)),r.innerHTML='<a href="#" tabindex="0" class="page-link">»</a>',t.appendChild(r)}}this.el?this.el.innerHTML="":(this.el=document.createElement("div"),this.node.appendChild(this.el));const n=this.el;n.className=this.options.className||"",n.appendChild(t),n.appendChild(e),n.appendChild(r)}}u.spiralFrameworkName="datagrid-paginator",u.defaultOptions={id:"",lockType:"none",fetchCount:!0,fetchCountOnce:!0,type:l.pages,className:"row no-gutters align-items-center m-3",limitOptions:[10,25,50,100]};var p=u;const f=(t,e)=>{const r=e.map(t=>"string"==typeof t?{field:t,direction:void 0}:t);return t.map(t=>{let e,i,s;"string"==typeof t?(e=t,i=t,s=n.ASC):(e=t.id,i=t.title||t.id,s=t.sortDir||n.ASC);const o=r.find(t=>t.field===e);return o?{id:e,title:i,sortable:!0,direction:o.direction||s}:{id:e,title:i,sortable:!1,direction:n.ASC}})},h=(t,e)=>{Object.keys(e).forEach(r=>{t.setAttribute(r,e[r])})},d=(t,e,r)=>{const n=document.createElement("tbody");if(t.appendChild(n),r.hasError){const t=document.createElement("tr"),i=document.createElement("td");i.colSpan=e.columns.length,i.innerText=r.errorMessage||"Unknown Error",i.classList.add("sf-table__error"),t.appendChild(i),n.appendChild(t)}else if(0===r.data.length){const t=document.createElement("tr"),r=document.createElement("td");r.colSpan=e.columns.length,r.innerHTML="No Data",r.classList.add("sf-table__empty"),t.appendChild(r),n.appendChild(t)}return n},g=(t,e,r)=>{},m=(t,e,r)=>{const i=document.createElement("th"),s=[];return t.sortable&&(s.push("sf-table__sort"),i.addEventListener("click",()=>{r.parent.triggerSort(t.id)})),r.sortBy===t.id&&(r.sortDir===n.ASC?s.push("sf-table__sort_asc"):s.push("sf-table__sort_desc")),i.innerHTML=`<div class="${s.join(" ")}">${t.title}</div>`,i},y=(t,e,r)=>{const n=document.createElement("thead");t.appendChild(n);const i=document.createElement("tr");return n.appendChild(i),n},b=(t,e,r,n)=>{const i=document.createElement("td");return i.innerText=r.data[n][t.id],i},v=(t,e,r,n)=>{const i=document.createElement("tr");return t.appendChild(i),i},E=(t,e)=>{const r=document.createElement("table");return r.className=e.ui.tableClassName||"",t.appendChild(r),r};class O{constructor(t,e){this.options=t,this.root=e,this.columnInfo=f(this.options.columns,this.options.sortable),console.log(this.columnInfo),this.create()}create(){this.wrapper=document.createElement("div"),this.wrapper.setAttribute("role","sf-datagrid-wrapper"),this.wrapper.setAttribute("class",this.options.ui.wrapperClassName||""),this.root.node.innerHTML="",this.root.node.appendChild(this.wrapper);const t=this.options.tableWrapper||E;this.tableEl=t(this.wrapper,this.options)}applyAdditionalCellAttributes(t,e,r,n,i){const s={id:e.id,column:e,index:i,rowSelected:!1,state:n,item:n.data[i]};if(r.ui.cellClassName)if("function"==typeof r.ui.cellClassName)t.classList.add(r.ui.cellClassName(s));else{const n=r.ui.cellClassName[e.id];n&&("string"==typeof n?t.classList.add(n):t.classList.add(n(s)))}if(r.ui.cellAttributes)if("function"==typeof r.ui.cellAttributes)h(t,r.ui.cellAttributes(s));else{const n=r.ui.cellAttributes[e.id];n&&h(t,"function"==typeof n?n(s):n)}}applyAdditionalHeaderCellAttributes(t,e,r,n){const i={id:e.id,column:e,index:0,rowSelected:!1,state:n,item:null};if(r.ui.headerCellClassName)if("function"==typeof r.ui.headerCellClassName)t.classList.add(r.ui.headerCellClassName(i));else{const n=r.ui.headerCellClassName[e.id];n&&("string"==typeof n?t.classList.add(n):t.classList.add(n(i)))}if(r.ui.headerCellAttributes)if("function"==typeof r.ui.headerCellAttributes)h(t,r.ui.headerCellAttributes(i));else{const n=r.ui.headerCellAttributes[e.id];n&&h(t,"function"==typeof n?n(i):n)}}render(t){const e=this.options.headerWrapper||y;this.headerEl&&this.tableEl.removeChild(this.headerEl),this.headerEl=e(this.tableEl,this.options,t),this.headerEl&&(this.tableEl.appendChild(this.headerEl),this.columnInfo.length&&this.columnInfo.forEach((e,r)=>{const n=((this.options.headerList||{})[e.id]||m)(e,this.options,t);this.applyAdditionalHeaderCellAttributes(n,e,this.options,t),this.headerEl.appendChild(n)})),this.bodyEl&&this.tableEl.removeChild(this.bodyEl);const r=this.options.bodyWrapper||d;if(this.bodyEl=r(this.tableEl,this.options,t),this.bodyEl){this.tableEl.appendChild(this.bodyEl);const e=this.options.rowWrapper||v;t.data.forEach((r,n)=>{const i=e(this.bodyEl,this.options,t,n);this.columnInfo.forEach(e=>{const r=((this.options.cells||{})[e.id]||b)(e,this.options,t,n);this.applyAdditionalCellAttributes(r,e,this.options,t,n),i.appendChild(r)})})}this.footerEl&&this.tableEl.removeChild(this.footerEl);const n=this.options.footerWrapper||g;this.footerEl=n(this.tableEl,this.options,t),this.footerEl&&this.tableEl.appendChild(this.footerEl)}}var w=function(t,e,r,n){return new(r||(r=Promise))((function(i,s){function o(t){try{c(n.next(t))}catch(t){s(t)}}function a(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,a)}c((n=n.apply(t,e||[])).next())}))};class j extends o.a.core.BaseDOMConstructor{constructor(t,e,r){super(),this.optionsToGrab={id:{value:j.defaultOptions.id,domAttr:"id"},url:{value:j.defaultOptions.url,domAttr:"data-url"}},this.options=Object.assign({},j.defaultOptions),this.grids=[],this.state=new c(this),this.capturedForms=[],this.capturedPaginators=[],this.init(t,e,r),this.options=Object.assign(Object.assign({},j.defaultOptions),this.options);const i=e.querySelector('script[role="sf-options"]');if(i)try{const t=Function('"use strict";return '+i.innerHTML.trim())()();this.options=Object.assign(Object.assign({},this.options),t)}catch(t){throw console.error("Could not parse options inside script, ensure script inside is an anonymous function returning IDataGridOptions object"),t}a.notEqual(this.options.id,"","id should be not empty"),a.notEqual(this.options.url,"","url should be not empty"),this.columnInfo=f(this.options.columns,this.options.sortable),this.options.sort&&("string"==typeof this.options.sort?this.state.setSort(this.options.sort,n.ASC):this.state.setSort(this.options.sort.field,this.options.sort.direction||n.ASC)),this.createRenderers(),this.captureForms(),this.request()}registerFormInstance(t){t.options&&t.options.id&&this.options.captureForms.indexOf(t.options.url)>=0&&(this.capturedForms.push(t),t.options.jsonOnly=!0,t.options.beforeSubmitCallback=e=>(this.resetPaginator(),this.state.setFormData(t.options.id,e.data),this.request(),!1))}registerPaginatorInstance(t){t.options&&t.options.id&&this.options.captureForms.indexOf(t.options.id)>=0&&(this.capturedPaginators.push(t),t.options.onPageChange=t=>(this.state.updatePaginator(t),this.request(),!1))}captureForms(){(this.sf.getInstances("form")||[]).forEach(t=>{this.registerFormInstance(t.instance)}),(this.sf.getInstances(p.spiralFrameworkName)||[]).forEach(t=>{this.registerFormInstance(t.instance)}),this.sf.instancesController.events.on("onAddInstance",({instance:t,type:e})=>{"form"===e&&this.registerFormInstance(t),e===p.spiralFrameworkName&&this.registerPaginatorInstance(t)})}triggerSort(t){if(this.state.sortBy===t)this.state.sortDir===n.ASC?this.state.setSort(t,n.DESC):this.state.setSort(t,n.ASC);else{const e=this.columnInfo.find(e=>e.id===t);e?this.state.setSort(e.id,e.direction):console.warn(`Trying to sort by unsortable field ${t}`)}this.resetPaginator(),this.request()}resetPaginator(){this.state.updatePaginator({page:1}),this.capturedPaginators.forEach(t=>{t.setParams&&t.setParams(this.state.paginate)})}formRequest(){return{fetchCount:!0,filter:this.state.getFilter(),paginate:this.state.paginate,sort:this.state.sortBy?{[this.state.sortBy]:this.state.sortDir}:{}}}unlock(){this.sf.removeInstance("lock",this.node)||console.warn("You try to remove 'lock' instance, but it is not available or not started"),this.capturedForms.forEach(t=>{t.unlock&&t.unlock()}),this.capturedPaginators.forEach(t=>{t.unlock&&t.unlock()})}lock(){if(!this.options.lockType||"none"===this.options.lockType)return;this.sf.addInstance("lock",this.node,{type:this.options.lockType})?(this.capturedForms.forEach(t=>{t.lock&&t.lock()}),this.capturedPaginators.forEach(t=>{t.lock&&t.lock()})):console.warn("You try to add 'lock' instance, but it is not available or already started")}handleSuccess({data:t}){console.log("Success",t),this.state.setSuccess(t.data,t.pagination),this.render(),this.capturedPaginators.forEach(t=>{t.setParams&&t.setParams(this.state.paginate)})}beforeSubmit(){this.capturedForms.forEach(t=>{t.removeMessages&&t.removeMessages()})}handleError({data:t,status:e,statusText:r}){console.log("Error",t),this.state.setError(t.error,t.errors,this.options.resetOnError),this.capturedForms.forEach(n=>{n.processAnswer&&n.processAnswer({data:t,status:e,statusText:r})}),this.capturedPaginators.forEach(n=>{n.processAnswer&&n.processAnswer({data:t,status:e,statusText:r})}),this.render()}request(){return w(this,void 0,void 0,(function*(){if(this.state.isLoading)return void console.warn("Cant start new request");this.state.startLoading(),this.beforeSubmit(),this.lock();const t=this.formRequest(),e=this.sf.ajax.send({url:this.options.url,method:this.options.method,headers:this.options.headers,data:t});try{const t=yield e;this.handleSuccess(t)}catch(t){t.isSFAjaxError?this.handleError(t):this.handleError({data:{error:t.toString(),originalError:t},status:1e3,statusText:t.toString()})}finally{this.unlock(),this.state.stopLoading()}}))}createRenderers(){a.deepEqual(this.grids,[],"Grids are already initialized"),(Array.isArray(this.options.renderers)?this.options.renderers:[this.options.renderers]).forEach(t=>{this.grids.push(new O(Object.assign(Object.assign({},t),{columns:t.columns&&t.columns.length?t.columns:this.options.columns,sortable:t.sortable&&t.sortable.length?t.sortable:this.options.sortable}),this))})}render(){this.grids.forEach(t=>{t.render(this.state)})}}j.spiralFrameworkName="datagrid",j.defaultOptions={id:"",lockType:"default",resetOnError:!1,captureForms:[],columns:[],headers:{},method:i.POST,sortable:[],url:"",ui:{cellAttributes:{},rowAttributes:{},rowClassName:"",cellClassName:{},tableClassName:"table table-stripped",wrapperClassName:"table-responsive"},renderers:{columns:[],sortable:[],ui:{wrapperClassName:"table-responsive",tableClassName:"table table-striped",cellClassName:{},rowClassName:"",cellAttributes:t=>({}),rowAttributes:t=>({})}}};var C=j;const S={simpleCellFormatter:(t=(t=>t?t.toString():""),e="td")=>(r,n,i,s)=>{const o=document.createElement(e);return o.innerHTML=t(i.data[s][r.id],i.data[s]),o}};window.SFDatagridTools=S,o.a.registerInstanceType(C,"sf-js-datagrid"),o.a.registerInstanceType(p,"sf-js-datagrid-paginator"),o.a.events.on("ddd");e.default=C}])}));
//# sourceMappingURL=datagrid.js.map